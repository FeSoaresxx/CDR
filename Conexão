<?php
$host = "localhost";
$usuario = "root";
$senha = "InfoLabin012025";
$banco = "cafeteria";

$conn = new mysqli($host, $usuario, $senha, $banco);

if ($conn->connect_error) {
    die("Erro na conexão: " . $conn->connect_error);
}
?>

<?php
include "conexao.php";
$resultado = $conn->query("SELECT * FROM clientes");
?>

<h2>Clientes da Cafeteria</h2>
<a href="adicionar.php">Cadastrar Novo Cliente</a><br><br>

<table border="1" cellpadding="8">
    <tr>
        <th>ID</th>
        <th>Nome</th>
        <th>Email</th>
        <th>Telefone</th>
        <th>Data de Cadastro</th>
        <th>Ações</th>
    </tr>
    <?php while($cliente = $resultado->fetch_assoc()) { ?>
    <tr>
        <td><?= $cliente['id'] ?></td>
        <td><?= $cliente['nome'] ?></td>
        <td><?= $cliente['email'] ?></td>
        <td><?= $cliente['telefone'] ?></td>
        <td><?= $cliente['data_cadastro'] ?></td>
        <td>
            <a href="editar.php?id=<?= $cliente['id'] ?>">Editar</a> |
            <a href="excluir.php?id=<?= $cliente['id'] ?>" onclick="return confirm('Deseja realmente excluir?')">Excluir</a>
        </td>
    </tr>
    <?php } ?>
</table>
<?php
include "conexao.php";

if ($_SERVER["REQUEST_METHOD"] == "POST") {
    $nome = $_POST["nome"];
    $email = $_POST["email"];
    $telefone = $_POST["telefone"];
    $data = date('Y-m-d'); // Pega a data de hoje

    $conn->query("INSERT INTO clientes (nome, email, telefone, data_cadastro) VALUES ('$nome', '$email', '$telefone', '$data')");
    header("Location: index.php");
}
?>

<h2>Cadastrar Novo Cliente</h2>
<form method="POST">
    Nome: <input type="text" name="nome" required><br>
    Email: <input type="email" name="email"><br>
    Telefone: <input type="text" name="telefone"><br>
    <input type="submit" value="Salvar">
</form>
<a href="index.php">Voltar</a>
<?php
include "conexao.php";

$id = $_GET["id"];
$cliente = $conn->query("SELECT * FROM clientes WHERE id = $id")->fetch_assoc();

if ($_SERVER["REQUEST_METHOD"] == "POST") {
    $nome = $_POST["nome"];
    $email = $_POST["email"];
    $telefone = $_POST["telefone"];

    $conn->query("UPDATE clientes SET nome='$nome', email='$email', telefone='$telefone' WHERE id=$id");
    header("Location: index.php");
}
?>

<h2>Editar Cliente</h2>
<form method="POST">
    Nome: <input type="text" name="nome" value="<?= $cliente['nome'] ?>" required><br>
    Email: <input type="email" name="email" value="<?= $cliente['email'] ?>"><br>
    Telefone: <input type="text" name="telefone" value="<?= $cliente['telefone'] ?>"><br>
    <input type="submit" value="Atualizar">
</form>
<a href="index.php">Voltar</a>
<?php
include "conexao.php";

$id = $_GET["id"];
$conn->query("DELETE FROM clientes WHERE id = $id");

header("Location: index.php");
